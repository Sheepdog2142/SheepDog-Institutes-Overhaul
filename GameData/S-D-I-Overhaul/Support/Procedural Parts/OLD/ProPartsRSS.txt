//
//ProceduralParts fixes
//
!PARTUPGRADE[ProceduralParts*]:NEEDS[ProceduralParts] {}


PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrengineering101
    partIcon = proceduralTankLiquid
    techRequired = generalConstruction
    title = Procedural Tank (1.25)
    description = Procedural Tank min diameter 1.25
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrpostWarMaterialsScience
    cumulativeCost = true
    partIcon = proceduralTankLiquid
    techRequired = advConstruction
    title = Procedural Tank (1.875)
    description = Procedural Tank min diameter 1.875
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrgeneralConstruction
    partIcon = proceduralTankLiquid
    techRequired = advFuelSystems
    title = Procedural Tank (2.5)
    description = Procedural Tank max diameter is 2.5
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrmaterialsScienceAdvCapsules
    partIcon = proceduralTankLiquid
    techRequired = largeVolumeContainmen
    title = Procedural Tank (3.75)
    description = Procedural Tank max diameter is 5.0
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrfuelSystems
    partIcon = proceduralTankLiquid
    techRequired = highPerformanceFuelSystems
    title = Procedural Tank (5)
    description = Procedural Tank max diameter is 7.5
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrspecializedConstruction
    partIcon = proceduralTankLiquid
    techRequired = specializedFuelStorage
    title = Procedural Tank (7.5)
    description = Procedural Tank max diameter is 7.5
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtradvFuelSystems
    partIcon = proceduralTankLiquid
    techRequired = extremeFuelStorage
    title = Procedural Tank (Unlimited)
    description = Procedural Tank max diameter is unlimited
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrbasicLifeSupport
    partIcon = proceduralTankOre
    techRequired = logistics
    title = Procedural Ore Tank
    description = Procedural Ore Tank
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrimprovedLifeSupport
    partIcon = proceduralTankOre
    techRequired = longTermHabitation
    title = Procedural Ore Tank (Expanded)
    description = Procedural Ore Tank dimensions are increased
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrlongTermLifeSupport
    partIcon = proceduralTankOre
    techRequired = advlogistics
    title = Procedural Ore Tank (Unlimited)
    description = Procedural Ore Tank dimensions are unlimited
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrelectronicsSatellite
    partIcon = proceduralBattery
    techRequired = advelectrics
    title = Procedural Battery (small)
    description = Procedural Batteries small
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrelectronicsHuman
    partIcon = proceduralBattery
    techRequired = largeElectrics
    title = Procedural Battery (medium)
    description = Procedural Batteries medium
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrminiaturization
    partIcon = proceduralBattery
    techRequired = specializedElectrics
    title = Procedural Battery (large)
    description = Procedural Batteries large
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrelectronicsSpaceStation
    partIcon = proceduralBattery
    techRequired = experimentalElectrics
    title = Procedural Battery (huge)
    description = Procedural Batteries huge
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrspaceStationSolarPanels
    partIcon = proceduralBattery
    techRequired = experimentalElectricalSystems
    title = Procedural Battery (unlimited)
    description = Procedural Batteries unlimited
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsupersonicFlightRP0
    partIcon = proceduralNoseCone
    techRequired = earlyAviation
    title = Procedural NoseCone (small)
    description = Procedural NoseCone small
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrhypersonicFlightRP0
    partIcon = proceduralNoseCone
    techRequired = aerodynamicSystems
    title = Procedural NoseCone (medium)
    description = Procedural NoseCone medium
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrprototypeSpaceplanes
    partIcon = proceduralNoseCone
    techRequired = heavyAerodynamics
    title = Procedural NoseCone (large)
    description = Procedural NoseCone large
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtraerodynamicSystems
    partIcon = proceduralNoseCone
    techRequired = aerospaceComposites
    title = Procedural NoseCone (unlimited)
    description = Procedural NoseCone unlimited
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrflightControl
    partIcon = proceduralHeatshield
    techRequired = advLanding
    title = Procedural Heatshield (medium)
    description = Procedural Heatshield small
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrearlyLanding
    partIcon = proceduralHeatshield
    techRequired = heavyLanding
    title = Procedural Heatshield (large)
    description = Procedural Heatshield maximum diameter is 3m
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrlunarRatedHeatshields
    partIcon = proceduralHeatshield
    techRequired = metaMaterials
    title = Procedural Heatshield (huge)
    description = Procedural Heatshield huge
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtradvUnmanned
    partIcon = proceduralHeatshield
    techRequired = exoticAlloys
    title = Procedural Heatshield (unlimited)
    description = Procedural Heatshield unlimited
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrbasicSolids
    partIcon = proceduralTankSRB
    techRequired = generalRocketry
    title = Procedural SRB (early)
    description = Procedural ESRB
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsolids1956
    partIcon = proceduralTankSRB
    techRequired = advRocketry
    title = Procedural SRB General
    description = Procedural MSRB
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsolids1958
    partIcon = proceduralTankSRB
    techRequired = heavyRocketry
    title = Procedural SRB Advanced
    description = Procedural MHSRB
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsolids1962
    partIcon = proceduralTankSRB
    techRequired = veryHeavyRocketry
    title = Procedural SRB Heavy
    description = Procedural HSRB
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsolids1964
    partIcon = proceduralTankSRB
    techRequired = experimentalRocketry
    title = Procedural SRB Very Heavy 
    description = Procedural VHSRB
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsolids1969
    partIcon = proceduralTankSRB
    techRequired = giganticRocketry
    title = Procedural SRB Experimental
    description = Procedural ESRB
}

PARTUPGRADE:NEEDS[ProceduralParts]
{
    name = lrtrsolids1972
    partIcon = proceduralTankSRB
    techRequired = colossalRocketry
    title = Procedural SRB (unlimited)
    description = Procedural CSRB
}

@PART[*]:HAS[@MODULE[ProceduralPart]]:FINAL
{
	MODULE
	{
		name = ModuleTagNotRescaled
	}
}

@PART[*]:HAS[@MODULE[ProceduralShapeCone]]:FINAL
{
    @MODULE[ProceduralShapeCone]
    {
        @techRequired = engineering101
    }
}
@PART[*]:HAS[@MODULE[ProceduralShapePill]]:FINAL
{
    @MODULE[ProceduralShapePill]
    {
        @techRequired = engineering101
    }
}
@PART[*]:HAS[@MODULE[ProceduralShapeBezierCone]]:FINAL
{
    @MODULE[ProceduralShapeBezierCone]
    {
        @techRequired = engineering101
    }
}

@PART[proceduralTankLiquid|proceduralTankRealFuels]:FINAL
{
    MODULE
    {
        name = ModuleTagNotRescaled
    }
    @MODULE[ProceduralPart]
    {
        @diameterMin = 0.625
        @diameterMax = 0.98
        @lengthMin = 0.625
        @lengthMax = 5
        @volumeMin = 0
        @volumeMax = Infinity
        
        -UPGRADES,* {} 
        
        UPGRADES {
            UPGRADE
            {
                name = lrtrpostWarMaterialsScience
                @diameterMin = 0.625
                @diameterMax = 1.25
                @lengthMin = 0.625
                @lengthMax = 10
            }
            UPGRADE
            {
                name = lrtrengineering101
                @diameterMin = 0.1
                @diameterMax = 1.875
                @lengthMin = 0.1
                @lengthMax = 15
            }
            UPGRADE
            {
                name = lrtrgeneralConstruction
                @diameterMin = 0.1
                @diameterMax = 2.5
                @lengthMin = 0.1
                @lengthMax = 20
            }
            UPGRADE
            {
                name = lrtrmaterialsScienceAdvCapsules
                @diameterMin = 0.1
                @diameterMax = 3.75
                @lengthMin = 0.1
                @lengthMax = 30
            }
            UPGRADE
            {
                name = lrtrfuelSystems
                @diameterMin = 0.1
                @diameterMax = 5
                @lengthMin = 0.1
                @lengthMax = 40
            }
            UPGRADE
            {
                name = lrtrspecializedConstruction
                @diameterMin = 0.1
                @diameterMax = 7.5
                @lengthMin = 0.1
                @lengthMax = 50
            }
            UPGRADE
            {
                name = lrtradvFuelSystems
                @diameterMin = 0.1
                @diameterMax = Infinity
                @lengthMin = 0.1
                @lengthMax = Infinity
            }
        }
    }
}


@PART[proceduralStructural]:FINAL
{  
    MODULE
    {
        name = ModuleTagNotRescaled
    }

    @MODULE[ProceduralPart]
    {
 
        @diameterMin = 1.0
        @diameterMax = 1.25
        @lengthMax = Infinity
        @lengthMin = 0.625
        @volumeMin = 0
        @volumeMax = Infinity
        
         -UPGRADES,* {} 

        UPGRADES {
            UPGRADE
            {
                name = lrtrengineering101
                diameterMin = 0.1	
                lengthMin = 0.1
            }
            UPGRADE
            {
                name = lrtrgeneralConstruction
                diameterMax = 1.875
            }
            UPGRADE
            {
                name = lrtrmaterialsScienceAdvCapsules
                diameterMax = 2.5
            }
            UPGRADE
            {
                name = lrtrfuelSystems
                diameterMax = 3.5
            }
            UPGRADE
            {
                name = lrtrspecializedConstruction
                diameterMax = 5
            }
            UPGRADE
            {
                name = lrtradvFuelSystems
                diameterMax = Infinity
            }
        }
    }
}

@PART[proceduralTankOre]:FINAL
{
    MODULE
    {
        name = ModuleTagNotRescaled
    }

    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {} 
        
        @diameterMin = 0.1
        @lengthMin = 0.1
        @volumeMin = 1.0
        
        UPGRADES
        {
           UPGRADE
            {
                name = lrtrbasicLifeSupport
                diameterMax = 1.5
                lengthMax = 1.75
                volumeMax = 2.5
            }
            UPGRADE
            {
                name = lrtrimprovedLifeSupport
                diameterMax = 3.5
                lengthMax = 5.0
                volumeMax = 15.0
            }
            UPGRADE
            {
                name = lrtrlongTermLifeSupport
			    diameterMin = 0.01
    			diameterMax = Infinity
	    		lengthMin = 0.01
		    	lengthMax = Infinity
			    volumeMin = 0.01
    			volumeMax = Infinity
            }
        }
    }
}

@PART[proceduralTankRCS]:FINAL
{    
    MODULE
    {
        name = ModuleTagNotRescaled
    }

    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {}
        
        @diameterMin = 0.5
        @lengthMin = 0.3
        @volumeMin = 0.11
        
        UPGRADES
        {
            UPGRADE
            {
                name = lrtrmaterialsScienceAdvCapsules
                diameterMax = 2.5
                lengthMax = 2.0
                volumeMax = 5.0
            }
            UPGRADE
            {
                name = lrtrspecializedConstruction
			    diameterMin = 0.01
    			diameterMax = Infinity
	    		lengthMin = 0.01
		    	lengthMax = Infinity
			    volumeMin = 0.01
    			volumeMax = Infinity
            }
        }
    }
}

@PART[proceduralTankXenon]:FINAL
{       
    MODULE
    {
        name = ModuleTagNotRescaled
    }

    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {}
        
        @diameterMin = 0.125
        @diameterMax = 0.75
        @lengthMin = 0.1
        @lengthMax = 0.75
        @volumeMin = 0.02
        @volumeMax = 0.2
        
        UPGRADES
        {
            UPGRADE
            {
                name = lrtradvancedElecPropulsion
                diameterMin = 0.01
                diameterMax = Infinity
                lengthMin = 0.01
                lengthMax = Infinity
                volumeMin = 0.01
                volumeMax = Infinity
            }
        }
    }
}

@PART[proceduralBattery]:FINAL
{ 
    MODULE
    {
        name = ModuleTagNotRescaled
    }
    
    @MODULE[ProceduralShapeCone]
    {
        @techRequired = electronicsHuman
    }
    @MODULE[ProceduralShapePill]
    {
        @techRequired = electronicsAdvCapsules
    }
    @MODULE[ProceduralShapeBezierCone]
    {
        @techRequired = electronicsAdvCapsules
    }
        
    @MODULE[ProceduralPart]
    {
        @diameterMin = 0.1
        @diameterMax = 0.625
        @lengthMax = 0.1
        @lengthMin = 0.01
        @volumeMin = 0
        @volumeMax = Infinity
        
        -UPGRADES,* {}
        
        UPGRADES {
           UPGRADE
           {
                name = lrtrelectronicsSatellite
                lengthMax = 0.4
            }
            UPGRADE
            {
                name = lrtrelectronicsHuman
                diameterMax = 1.25
            }
            UPGRADE
            {
                name = lrtrminiaturization
                diameterMax = 1.875
                lengthMax = 0.5
            }
            UPGRADE
            {
                name = lrtrelectronicsSpaceStation
                diameterMax = 2.5
                maxLength = 1
            }
            UPGRADE
            {
                name = lrtrspaceStationSolarPanels
                diameterMin = 0.01
                diameterMax = Infinity
                lengthMin = 0.01
                lengthMax = Infinity
                volumeMin = 0.001
            }
        }
    }
}

@PART[proceduralNoseCone]:FINAL
{   
    MODULE
    {
        name = ModuleTagNotRescaled
    }

    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {}
        
        UPGRADES
        {
            UPGRADE
            {
                name = lrtrsupersonicFlightRP0
                diameterMin = 0.125
                diameterMax = 1.25
                lengthMin = 0.625
                lengthMax = 0.625
            }
            UPGRADE
            {
                name = lrtrhypersonicFlightRP0
                lengthMax = 1.5
            }
            UPGRADE
            {
                name = lrtrprototypeSpaceplanes
                diameterMax = 2.5
            }
            UPGRADE
            {
                name = lrtraerodynamicSystems
                diameterMin = 0.01
                diameterMax = Infinity
            }
        }
    }
}

@PART[proceduralHeatshield]:FINAL
{
    MODULE
    {
        name = ModuleTagNotRescaled
    }
         
    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {}
        
        UPGRADES
        {
            UPGRADE
            {
                name = lrtrflightControl
                diameterMin = 0.5
                diameterMax = 1.25
            }
            UPGRADE
            {
                name = lrtrearlyLanding
                diameterMax = 2.5
            }
            UPGRADE
            {
                name = lrtrlunarRatedHeatshields
                diameterMax = 3.5
            }
            UPGRADE 
            {
                name = lrtradvUnmanned
                diameterMin = 0.01
                diameterMax = Infinity
                lengthMin = 0.1
                lengthMax = Infinity
                volumeMin = 0.01
                volumeMax = Infinity
            }
		}
    }
}

@PART[proceduralTankSRB|proceduralSRBRealFuels]:FINAL
{
    MODULE
    {
        name = ModuleTagNotRescaled
    }

    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {}
 		
        @diameterMin = 0.5
        @diameterMax = 0.625
        @lengthMin = 1.0
        @lengthMax = 1.5
        @volumeMin = 0
 		@volumeMax = Infinity
		
 		UPGRADES
 		{
            UPGRADE
            {
                name = lrtrbasicSolids
                diameterMax = 1.25
            }
            UPGRADE
            {
                name = lrtrsolids1956
                diameterMin = 0.02
                lengthMin = 0.1
            }
            UPGRADE
            {
                name = lrtrsolids1958
                lengthMax = 6.0
            }
            UPGRADE
            {
                name = lrtrsolids1962
                lengthMax = 14.0
            }
            UPGRADE
            {
                name = lrtrsolids1964
                diameterMax = 1.875
            }
            UPGRADE
            {
                name = lrtrsolids1969
                diameterMax = 2.5
            }
            UPGRADE 
            {
                name = lrtrsolids1972
                diameterMin = 0.01
                diameterMax = Infinity
                lengthMin = 0.1
                lengthMax = Infinity
            }
        }
    }
}

@PART[proceduralStackDecoupler]:FINAL
{
    @MODULE[ProceduralPart]
    {
        -UPGRADES,* {}
        
        UPGRADES
        {
            UPGRADE
            {
                name = lrtrengineering101
                diameterMin = 0.5
                diameterMax = 1.25
            }
            UPGRADE
            {
                name = lrtrgeneralConstruction
                diameterMax = 1.875
            }
            UPGRADE
            {
                name = lrtrmaterialsScienceAdvCapsules
                diameterMax = 2.5
            }
            UPGRADE
            {
                name = lrtrmaterialsScienceAdvCapsules
                diameterMax = 2.5
            }
            UPGRADE
            {
                name = lrtrfuelSystems
                diameterMax = 3.5
            }
            UPGRADE
            {
                name = lrtrspecializedConstruction
                diameterMax = 5.0
            }
            UPGRADE
            {
                name = lrtradvFuelSystems
                diameterMax = Infinity
            }
        }
    }
    MODULE[DecouplerTweaker]
    {
        @separatorTechRequired = generalConstruction
    }
}

@PART[*]:HAS[@MODULE[ProceduralPart]]:NEEDS[LRTRRescale]:FINAL
{
    @MODULE[TankContentSwitcher]
    {
        @TANK_TYPE_OPTION,*
        {
            @dryDensity *= 0.8
            //@RESOURCE[SolidFuel]
            //{
            //    @unitsPerT *= 1.6
            //}
            @RESOURCE[MonoPropellant]
            {
                @unitsPerT *= 0.45
            }
        }
    }
    @MODULE[ProceduralPart]
    {
        @diameterMin *= 1.6
        @diameterMax *= 1.6
        @lengthMin *= 1.6
        @lengthMax *= 1.6
        @volumeMin *= 3.6
        @volumeMax *= 3.6

        @UPGRADES
        {
            @UPGRADE,*
            {
                @diameterMin *= 1.6
                @diameterMax *= 1.6
                @lengthMin *= 1.6
                @lengthMax *= 1.6
                @volumeMin *= 3.6
                @volumeMax *= 3.6
            }
        }
        @TECHLIMIT,*
        {
            @diameterMin *= 1.6
            @diameterMax *= 1.6
            @lengthMin *= 1.6
            @lengthMax *= 1.6
            @volumeMin *= 3.6
            @volumeMax *= 3.6
        }        
    }
    @MODULE[ProceduralSRB]
    {
        @thrust1m *= 2.56
    }
}